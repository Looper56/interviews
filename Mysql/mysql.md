### Mysql Basics

#### Mysql架构
 mysql架构可以在多种不同场景作用，主要体现在存储引擎架构上，`插件式存储引擎架构将查询处理和其他的系统任务以及数据的存储提取相分离`，根据业务选择
 - 连接层：最上层是一些客户端和连接服务，主要完成类似连接处理，授权认证，相关安全方案，基于SSL安全链接
 - 服务层：核心服务功能，包括查询解析、分析、优化、缓存及内置函数，跨存储引擎包括触发器、存储过程、视图等
 - 引擎层：存储引擎真正负责mysql中数据的存储和提取，服务器通过API与存储引擎进行通信
 - 存储层：主要将数据存储在运行于该设备的文件系统上，并完成与存储引擎的交互
##### Mysql查询流程
 客户端请求 -> 连接器(验证用户身份，给予权限) -> 查询缓存(有则返回) -> 分析器(对SQL词法语法分析) -> 优化器(对执行sql选择最佳执行方案) -> 执行器(先看用户权限，使用引擎接口) -> 引擎层获取数据返回(开启缓存则缓存查询结果)

#### Mysql引擎
 常见存储引擎：InnoDB、MyISAM、Memory、NDB
 InnoDB是Mysql默认存储引擎，支持事务、行级锁定和外键
 MyISAM物理文件结构：
 - .frm：与表相关的元数据信息都存放在frm文件，包括表结构的定义信息
 - .MYD：存储表数据
 - .MYI：存储表索引相关信息
 InnoDB物理文件结构：
 - .frm：与表相关的元数据信息都存放在frm文件，包括表结构的定义信息
 - .ibd/.ibdata：都是存放InnoDB数据的文件，因为InnoDB的数据存储方式通过配置来决定`共享表空间`还是`独享表空间`
 InnoDB和MyISAM引擎区别：
 - InnoDB支持事务，成为mysql默认引擎重要原因之一
 - InnoDB支持外键，包含外键的转表会失败
 - InnoDB是聚簇索引，因此必须要有主键，聚簇索引文件存放在主键索引的叶子节点上，通过主键索引效率高，但是辅助索引需要两次查询，先查询主键，再通过主键查询数据，主键不宜过大，导致其他索引过大
 - InnoDB不保存表的具体行数，执行`select count(*)...`扫描全表，MyISAM用变量保存整表行数
 - InnoDB最小的锁粒度是行锁，MyISAM最小的锁粒度是表锁，更新语句会锁柱整张表，导致阻塞
 `一张表，里面有ID自增主键，当insert了17条记录之后，删除第15，16，17条记录，重启Mysql，再insert，该ID为`
 - MyISAM类型：18，MyISAM会把自增最大ID记录到数据文件中，重启不会丢失
 - InnoDB类型：15，InnoDB只是把最大ID记录到内存中，重启会对表进行OPTION操作，导致丢失

#### Mysql数据类型
 `CHAR和VARCHAR区别`
 - char是固定长度，varchar长度可变
 - char按规定长度分配存储空间，varchar根据实际分配空间
 - 相同点：超过最大长度限制后，字符串会被截断
 - 不同点：char存储上限为255字节，char存储时会截断尾部空格
 char适合存储很短、长度固定的字符串，例如MD5值
 `列的字符串类型可以是什么`
 - 字符串类型是：SET BLOB ENUM CHAR TEXT VARCHAR
 `BLOB和TEXT区别`
 - BLOB是二进制对象，可容纳可变数量数据，四种类型：BLOB TINYBLOB BLOB MEDIUMBLOB LONGBLOB
 - TEXT是一个不区分大小写的BLOB，四种类型：TINYTEXT TEXT MEDIUMTEXT LONGTEXT
 BLOB保存二进制数据，TEXT保存字符串数据

#### Mysql索引
 [索引参考](https://www.cnblogs.com/kungfupanda/p/12776674.html)
 索引(index)是帮助Mysql高效获取数据的`数据结构`
 简单理解为`排好序快速查找的数据结构`，数据本身之外，数据库还维护一个满足特定查找算法的数据结构
 索引本身也很大，不可能全部存储在内存中，一般以索引文件形式存储在磁盘上
 平常默认索引就是B+树(多路搜索树，不一定是二叉树)结构组织的索引，其中：聚集索引、次要索引，覆盖索引，复合索引、前缀索引，唯一索引默认都是使用B+树索引，此外还有哈希索引等
 优势：
 - 提高数据检索效率，降低数据库IO成本
 - 降低数据排序成本，降低CPU消耗
 劣势：
 - 索引也是一张表，保存主键和索引字段，并指向实体表的记录，所以也需要内存
 - 降低更新表的速度，更新时不仅保存数据，还要保存索引文件每次更新索引字段
 索引分类
 数据结构角度：
 - B+树索引
 - Hash索引
 - Full-Text全文索引
 - R-tree索引
 物理存储角度：
 - 聚簇索引
 - 非聚簇索引(辅助索引)
   都是B+树结构
 逻辑角度：
 - 主键索引：特殊的唯一索引，不允许有空值
 - 普通索引或单列索引：每个索引只包含单个列，一个表可以多个单列索引
 - 多列索引(复合索引、联合索引)：多个字段创建的索引，查询中使用创建索引的第一个字段，索引才会被使用，最左原则
 - 唯一索引或非唯一索引
 - 空间索引：是对空间数据类型字段建立的索引：GEOMETRY POINT LINESTRING POLYGON
   Mysql必须使用SPATIAL关键字进行扩展，使得能够用于创建正规索引类型的语法创建空间索引，空间索引列需声明为NOT NULL
   空间索引只能在存储引擎为MYISAM表创建
  索引实在存储引擎层面实现的，并不是所有存储引擎都支持所有的索引类型，实现和行为有差异
  B+树和B树的区别
  - B+树非叶子节点只包含导航信息，不包含实际的值，所有的叶子节点和相连的节点都使用链表相连，便于区间查找和遍历
  B+树优点在于
  - IO次数更少：内部节点上不包含数据信息，因此能够存放更多的key，数据存放更加紧密，更好的空间局部性，访问叶子关联数据也有更好的缓存命中率
  - 遍历更加方便：B+树的叶子节点都是相连的，因此整棵树只需要一次线性遍历即可，便于区间查找和搜索
  B树优点
  - 每个节点包含key和value，经常访问的元素可能离根节点更近，更迅速
  `为什么Mysql索引中用B+树，不用B树，为什么不用Hash索引`
  - B+树磁盘读写代价更低：B+树内部节点没有关键字具体信息指针，因此内部节点相对B树更小，读入内存的需要查找的关键字也就多，相对IO读写次数降低
  - B+树的查询效率更加稳定：由于非终结点并不是最终指向文件内容的节点，而只是叶子节点的关键字索引，关键字查询路径长度相同，数据查询效率相当
  - B+树更便于遍历：B+树数据都存储在叶子节点，分支节点为索引，方便扫库，B树节点存储着数据，需遍历按序来扫
  - B+树更适合基于范围的查询：B树再提高IO性能的同时并没有解决元素遍历的效率低下的问题，B+只需要遍历叶子节点就可以实现遍历整棵树的遍历，而且再数据库中基于范围查询是非常频繁的
